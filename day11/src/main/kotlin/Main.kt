import java.awt.Point
import kotlin.math.abs

fun main(args: Array<String>) {
    val grid = expand()
    println(findSum(grid))

    val grid2 = puzzle.lines().filter { it.isNotBlank() }.map { it.toMutableList() }.toMutableList()
    println(findSum2(grid2))
}

fun expand(): List<List<Char>> {
    val expanded = puzzle.lines().filter { it.isNotBlank() }.map { it.toMutableList() }.toMutableList()

    val iterator = expanded.listIterator()
    while (iterator.hasNext()) {
        val row = iterator.next()
        if (row.all { it == '.' }) {
            iterator.add(MutableList(row.size) { '.' })
        }
    }

    for (col in expanded[0].size - 1 downTo  0) {
        if (expanded.all { it[col] == '.' }) {
            expanded.forEach {
                it.add(col + 1, '.')
            }
        }
    }

    return expanded
}

fun findSum(grid: List<List<Char>>): Int {
    var sum = 0

    val coords = mutableListOf<Point>()
    grid.forEachIndexed { y, chars ->
        chars.forEachIndexed { x, c ->
            if (c == '#')
                coords += Point(x, y)
        }
    }

    for (i in coords.indices) {
        for (j in i + 1..<coords.size) {
            sum += abs(coords[i].x - coords[j].x) + abs(coords[i].y - coords[j].y)
        }
    }


    return sum
}

fun findSum2(grid: List<List<Char>>): Long {
    var sum = 0L

    val coords = mutableListOf<Point>()
    grid.forEachIndexed { y, chars ->
        chars.forEachIndexed { x, c ->
            if (c == '#')
                coords += Point(x, y)
        }
    }

    val spaceCoords = mutableListOf<Point>()
    val iterator = grid.listIterator()
    while (iterator.hasNext()) {
        val row = iterator.next()
        if (row.all { it == '.' }) {
            spaceCoords += Point(-1, iterator.nextIndex() - 1)
        }
    }

    for (col in grid[0].size - 1 downTo  0) {
        if (grid.all { it[col] == '.' }) {
            spaceCoords += Point(col, -1)
        }
    }

    for (i in coords.indices) {
        for (j in i + 1..<coords.size) {
            var numberOfSpacesX = 0
            var numberOfSpacesY = 0
            spaceCoords.forEach {
                if ((it.x in coords[i].x..coords[j].x) or (it.x in coords[i].x downTo coords[j].x)) {
                    numberOfSpacesX++
                }
                if ((it.y in coords[i].y..coords[j].y) or (it.y in coords[i].y downTo coords[j].y)) {
                    numberOfSpacesY++
                }
            }
            val xLength = abs(coords[i].x - coords[j].x) + 1000000 * numberOfSpacesX - numberOfSpacesX
            val yLength = abs(coords[i].y - coords[j].y) + 1000000 * numberOfSpacesY - numberOfSpacesY
            sum += xLength + yLength
        }
    }

    return sum
}

//const val puzzle = """
//...#......
//.......#..
//#.........
//..........
//......#...
//.#........
//.........#
//..........
//.......#..
//#...#.....
//"""

const val puzzle = """
................................................#.........#............................................#....................................
..#.............#......#.............................................#...........................................................#..........
..............................................................#..............................#..............................................
.................................................................................................................#..........................
...........#...........................#...............................................#..................................#.............#...
............................#..................#.....#..........................#...........................................................
..................................#................................#........................................................................
...........................................................................#................................................................
.....#...................................#......................................................#.......................#...........#.....#.
.....................#........#....................#....................................................#...................................
......................................................................#.....................................................................
...........................................................#.................................#..............................................
........#..................#....................#....................................................#......................................
#.............#....................................................#..............#.............................#...........................
...................#.............#...................................................................................#...............#......
.............................................................................#.............................................................#
.........................................................................................................#..................................
....#...........................................................................................#...........................#.....#.........
.....................#.......................#.........#....................................................................................
#............#.........................................................................#....................#...............................
................................#..................#...........#......#............................#...................#.......#............
.......................................................................................................................................#....
...................................................................................#........................................................
.........................#.............#...................................................................................#................
............................................................................................................................................
..........#..............................................................#......#.........#..........#......................................
............................................................................................................................................
.................................................................................................#............................#.............
................#...............................#............#.....................#........................................................
.#........................#..........................#......................................................#.......................#.......
.......#....................................#................................#..............................................................
.................................#.....................................#..................................................................#.
........................................................#.............................#...............................#........#............
.....................#...................#.....#...............#............................................................................
.............#...................................................................................................#..........................
................................................................................................#.....#...............................#.....
.................#................#................#........................................................................................
.#..........................#.............................#.......#.......#................................................................#
.............................................#.............................................................#................................
...........#.................................................................................#...............................#..............
.....................#.................................#.......#..................................................................#.....#...
.......#..............................#..............................................................#......................................
#...............................#.....................................#...............#........................#.......#....................
...........................................................................#.....#.........................................................#
...........................................................................................#................................................
........................................................#................................................#.......................#..........
.........#............#............................................#.................................................#.....#................
............................................................................................................................................
......................................#......#........................................................#.........#...........................
.............#.....#......#..........................#......................................................................................
......#................................................................................................................................#....
.............................................................................................................#..............................
..#.......#.............................#.....................#..................#........#.................................................
............................................................................................................................................
......................................................................................#...............................#.....................
..................#...........................#...........................#.........................#.........................#.............
............................................................................................................................................
......................................#..................................................#.........................................#........
.......................#.....#................................................................#.............#............#..................
.....#.............................................#.............#..........................................................................
.............#...........................................................#.......#..................................#...........#...........
.................................#..........................................................................................................
.............................................#...........#..................................................................................
.......#......................................................#............................#.........#........#.............................
.....................#................................................#...........................................................#.........
...............#...................#...............#.......................................................................#................
#..........................#......................................................................#.........................................
.............................................................................#..............................................................
...............................#......#.................#..............................................#..........#.........................
...........................................................................................................................................#
.................#......#.......................#....................................#.....#..............................#.................
.........#.............................................................#..................................#.................................
....................................................#............#............#.........................................................#...
..#.........................................................#........................................................#..........#...........
............................................................................................................................................
............................................................................................................................................
.......#...........................#..............................................................#.........................................
....................#...................................#................................................................#..................
..............................#.............................................................................................................
..#......................#.............................................#........#..........#................................................
..........#.............................#......................#................................................................#...........
.....................................................................................................#......................................
......................#.............................................................................................#......................#
#................#..................................#........................................#.................#............................
...................................#......#.......................#...........#..........................................#.............#....
............................................................................................................................................
..........#..............................................#..................................................................................
............................................................................................................................................
....................#......#..........#.......................#......#....................#..........#.......#..................#...........
...#.........................................................................#..............................................................
..................................................................................#..............#..........................................
........#.......................#..........#................................................................................................
..............#...........................................................................................#.................................
................................................................#.......................................................................#...
.......................#................#.....................................................................#.............................
....#............#............#.................................................................#.....#.....................................
...................................................................................................................#........................
...........................................#..............................................................................#.................
.......#.........................................#.......#.......#.....#...............................................................#....
................................................................................#...........#.....................................#.........
...........#.....................................................................................#..........................................
..............................................................#.............................................................................
...............#.........#..........#........................................................................#..............................
...........................................#......................................................................#......#..................
....#...............#.......................................................................................................................
......................................................................................#..............................................#......
...............................................#...............#..............#.................#...........................................
.#.........................................................................................#.........................#......................
................#......#................#................................#..........................#...........#...........................
......#......................#.....................#.......#................................................................................
.............................................#...........................................................#...............#.....#........#...
...........#.........................................................................#......................................................
............................................................................#...............................................................
.........................................................................................#............................#.....................
...................#...................#.....................#....................................#.............#...........................
.................................#..........................................................................................................
.......#......#...........#..................................................................................................#.....#........
.......................................................................#..............#........#.............#..............................
......................#..................#......#..............#..............#.....................................#..................#....
..........................................................................................#.............#...................................
.........#..........................................#..............#.......................................................#................
.............................#..............................................................................................................
.............................................#...................................#..........................................................
................#..................#........................................#......................................#........................
....#.................#.................#.............................................#.................................#..................#
............................................................#.........#..................................#..................................
......................................................#...................................#.................................................
.................................#..................................................................#.......................................
.................................................#...................................................................................#......
............................................................................................................................................
..................#.............................................#.............#.........................#................#..................
.........#.................................................#...........#.............#........#..............#............................#.
...................................#.........................................................................................#..............
............................................................................................................................................
#.....................#...................................................#.......#...............................#.........................
..............................#.................#........#..........................................................................#.......
..............#........................................................................#....................................................
...........................................#.............................................................#..............................#...
.................................#...................................................................................#...........#..........
...........#.......#.......#...........................#.....#................#......................#........#.............................
"""